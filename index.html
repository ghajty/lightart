<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>貓貓燈具</title>
<style>
/* ===== 全局 ===== */
body { margin:0; font-family: Arial, sans-serif; background: #f5f5f5; color:#333;}
a{color:#333; text-decoration:none;}
button{cursor:pointer; transition:0.2s;}
header{
  background: #fff; display:flex; align-items:center; justify-content:space-between;
  padding:10px 20px; border-bottom:1px solid #ddd;
  position:fixed; top:0; left:0; width:100%; z-index:1000;
}
header img{width:50px;height:50px;border-radius:50%;}
header h1{margin:0 20px; font-size:1.8em; color:#333;}
header nav button{
  padding:6px 12px; border:1px solid #333; border-radius:5px;
  background:#fff; color:#333;
}
header nav button:hover{background:#eee;}
.container{max-width:1000px; margin:100px auto 40px; padding:0 20px;}
#categoryToggle{cursor:pointer; background:#333; color:#fff; padding:8px; border-radius:5px; width:140px; text-align:center; margin:10px 0;}
#categoryToggle:hover{background:#555;}
#categoryList{display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px;}
#categoryList button{padding:5px 10px; background:#666; border:none; color:#fff; border-radius:5px;}
#categoryList button.active{background:#333;}
#categoryList button:hover{background:#555;}
.products{display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px;}
.product-card{background:#fff; border-radius:10px; padding:15px; text-align:center; box-shadow:0 1px 3px rgba(0,0,0,0.1);}
.product-card img{width:100%; height:180px; object-fit:cover; border-radius:5px;}
.product-card h3{margin:10px 0 5px;}
.product-card p{margin:0 0 10px;}
.product-card button{padding:5px 10px; margin:2px; background:#333; border:none; border-radius:5px; color:#fff;}
.product-card button:hover{background:#555;}
.side-panel{position:fixed; top:0; width:320px; height:100%; background:#fff; padding:20px; overflow-y:auto; border-left:1px solid #ddd; border-right:1px solid #ddd; transition: all 0.2s ease; z-index:950; display:none;}
.overlay{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.2); z-index:900;}
#orderModal{display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; padding:20px; border-radius:10px; max-height:80%; overflow-y:auto; z-index:1001;}
form{background:#fff; padding:15px; border-radius:10px; margin-bottom:20px; border:1px solid #ddd;}
form input, form select{width:100%; padding:8px; margin:5px 0 10px; border-radius:5px; border:1px solid #ccc; background:#fff; color:#333;}
form button{width:100%; padding:10px; background:#333; border:none; border-radius:5px; font-weight:bold; color:#fff;}
form button:hover{background:#555;}
</style>
</head>
<body>

<header>
<img src="https://placekitten.com/50/50" alt="公司頭貼">
<h1>貓貓燈具</h1>
<nav>
<button id="openAboutBtn">公司簡介</button>
<button id="openCartBtn">購物車</button>
<button id="openHistoryBtn">交易歷史</button>
<button id="openAdminBtn">後台管理</button>
</nav>
</header>

<div class="container">
<div id="memberArea"><span id="welcomeMsg"></span><button id="logoutBtn" style="display:none;">登出</button></div>

<div id="categoryToggle">顯示分類 ▼</div>
<div id="categoryList"></div>
<div class="products" id="productList"></div>

<form id="memberForm">
<h2>會員系統</h2>
<input type="text" id="memberUsername" placeholder="帳號" required>
<input type="password" id="memberPassword" placeholder="密碼" required>
<input type="email" id="memberEmail" placeholder="Email (註冊用)">
<button type="submit" id="memberBtn">註冊 / 登入</button>
</form>

<form id="checkoutForm">
<h2>顧客資料</h2>
<input type="text" id="name" placeholder="姓名" required>
<input type="tel" id="phone" placeholder="電話" required>
<input type="email" id="email" placeholder="Email" required>
<input type="text" id="address" placeholder="收貨地址" required>
<select id="payment" required>
<option value="">付款方式</option>
<option value="貨到付款">貨到付款</option>
<option value="線上付款">線上付款</option>
</select>
<button type="submit">下單</button>
</form>

<form id="adminForm">
<h2>後台管理 - 商品新增/修改</h2>
<input type="text" id="adminName" placeholder="商品名稱" required>
<input type="text" id="adminCategory" placeholder="分類" required>
<input type="number" id="adminPrice" placeholder="價格" required>
<input type="text" id="adminImg" placeholder="圖片URL" required>
<input type="text" id="adminDesc" placeholder="商品描述" required>
<button type="submit">新增 / 更新商品</button>
</form>
</div>

<div id="aboutSide" class="side-panel"><h2>公司簡介</h2><p>貓貓燈具專注於提供創意又高品質的室內照明產品，從吊燈到燈條，讓每個空間都溫暖舒適，營造獨特氛圍。</p><button id="closeAboutBtn">關閉</button></div>

<div id="cartSide" class="side-panel"><h2>購物車</h2><ul id="cartItems"></ul><p>總計：$<span id="cartTotal">0</span></p></div>

<div id="historySide" class="side-panel"><h2>歷史訂單</h2><ul id="historyListSide"></ul><button id="closeHistoryBtn">關閉</button></div>

<div id="orderModal"></div>
<div id="aboutOverlay" class="overlay"></div>
<div id="cartOverlay" class="overlay"></div>
<div id="historyOverlay" class="overlay"></div>
<div id="modalOverlay" class="overlay"></div>

<script>
// ===== 資料 =====
let products=[{id:1,name:"現代吊燈A",category:"吊燈",price:2500,img:"https://placekitten.com/300/180",desc:"適合客廳使用"},{id:2,name:"復古壁燈B",category:"壁燈",price:1200,img:"https://placekitten.com/301/180",desc:"適合走廊或臥室"},{id:3,name:"吸頂燈C",category:"吸頂燈",price:1800,img:"https://placekitten.com/302/180",desc:"節能又明亮"},{id:4,name:"投射燈D",category:"投射燈",price:900,img:"https://placekitten.com/303/180",desc:"可調整方向"},{id:5,name:"燈條E",category:"燈條",price:600,img:"https://placekitten.com/304/180",desc:"裝飾性強"},{id:6,name:"軌道燈F",category:"軌道燈",price:1500,img:"https://placekitten.com/305/180",desc:"適合展示空間"}];
const categories=["全部商品","吊燈","壁燈","吸頂燈","投射燈","燈條","軌道燈"];
let cart=[], currentMember=null;

// ===== 會員 =====
function updateMemberUI(){const welcome=document.getElementById("welcomeMsg");const logoutBtn=document.getElementById("logoutBtn");const memberForm=document.getElementById("memberForm");if(currentMember){welcome.textContent=`歡迎，${currentMember.username}`;logoutBtn.style.display="inline-block";memberForm.style.display="none";cart=currentMember.cart||[];renderCart();renderHistorySide();}else{welcome.textContent="";logoutBtn.style.display="none";memberForm.style.display="block";cart=[];renderCart();renderHistorySide();}}
document.getElementById("logoutBtn").addEventListener("click",()=>{currentMember=null;updateMemberUI();});
document.getElementById("memberForm").addEventListener("submit",e=>{e.preventDefault();const u=document.getElementById("memberUsername").value;const p=document.getElementById("memberPassword").value;const em=document.getElementById("memberEmail").value;let members=JSON.parse(localStorage.getItem("members"))||[];let member=members.find(m=>m.username===u);if(member){if(member.password===p){currentMember=member;}else{alert("密碼錯誤");return;}}else{member={username:u,password:p,email:em,cart:[],orders:[]};members.push(member);localStorage.setItem("members",JSON.stringify(members));currentMember=member;}updateMemberUI();});

// ===== 分類 =====
const categoryToggle=document.getElementById("categoryToggle");const categoryList=document.getElementById("categoryList");
categoryToggle.addEventListener("click",()=>{if(categoryList.style.display==="flex"){categoryList.style.display="none";categoryToggle.textContent="顯示分類 ▼";}else{categoryList.style.display="flex";categoryToggle.textContent="隱藏分類 ▲";}});
categories.forEach(cat=>{const btn=document.createElement("button");btn.textContent=cat;btn.addEventListener("click",()=>{displayProducts(cat);categoryList.querySelectorAll("button").forEach(b=>b.classList.remove("active"));btn.classList.add("active");});if(cat==="全部商品") btn.classList.add("active");categoryList.appendChild(btn);});

// ===== 顯示商品 =====
function displayProducts(filter="全部商品"){const list=document.getElementById("productList");list.innerHTML="";let filtered=filter==="全部商品"?products:products.filter(p=>p.category===filter);filtered.forEach(p=>{const div=document.createElement("div");div.className="product-card";div.innerHTML=`<img src="${p.img}" alt="${p.name}"><h3>${p.name}</h3><p>${p.desc}</p><p>價格: $${p.price}</p><button onclick="addToCart(${p.id},1)">加入購物車</button>`;list.appendChild(div);});}
displayProducts();

// ===== 購物車 =====
function addToCart(id,qty=1){const product=products.find(p=>p.id===id);const existing=cart.find(item=>item.id===id);if(existing) existing.qty+=qty; else cart.push({...product,qty:qty});saveCart();renderCart();}
function renderCart(){const ul=document.getElementById("cartItems");ul.innerHTML="";let total=0;cart.forEach((item,index)=>{const li=document.createElement("li");li.innerHTML=`${item.name} x ${item.qty} - $${item.price*item.qty}`;const removeBtn=document.createElement("button");removeBtn.textContent="移除";removeBtn.onclick=()=>{cart.splice(index,1);saveCart();renderCart();};li.appendChild(removeBtn);ul.appendChild(li);total+=item.price*item.qty;});document.getElementById("cartTotal").innerText=total;}
function saveCart(){if(currentMember){currentMember.cart=cart;updateMemberStorage();} else {localStorage.setItem("cart",JSON.stringify(cart));}}
function updateMemberStorage(){let members=JSON.parse(localStorage.getItem("members"))||[];const idx=members.findIndex(m=>m.username===currentMember.username);if(idx>=0){members[idx]=currentMember;localStorage.setItem("members",JSON.stringify(members));}}

// ===== 下單 =====
document.getElementById("checkoutForm").addEventListener("submit",e=>{e.preventDefault();if(cart.length===0){alert("請先加入商品");return;}const order={id:Date.now(),name:document.getElementById("name").value,phone:document.getElementById("phone").value,email:document.getElementById("email").value,address:document.getElementById("address").value,payment:document.getElementById("payment").value,items:cart};if(currentMember){currentMember.orders.push(order);currentMember.cart=[];cart=[];updateMemberStorage();}alert(`訂單 #${order.id} 已成立，Email 已發送至 ${order.email}`);renderCart();renderHistorySide();document.getElementById("checkoutForm").reset();});

// ===== 側邊欄 =====
const openAboutBtn=document.getElementById("openAboutBtn");const aboutSide=document.getElementById("aboutSide");const closeAboutBtn=document.getElementById("closeAboutBtn");const aboutOverlay=document.getElementById("aboutOverlay");
const openCartBtn=document.getElementById("openCartBtn");const cartSide=document.getElementById("cartSide");const cartOverlay=document.getElementById("cartOverlay");
const openHistoryBtn=document.getElementById("openHistoryBtn");const historySide=document.getElementById("historySide");const historyOverlay=document.getElementById("historyOverlay");const closeHistoryBtn=document.getElementById("closeHistoryBtn");
function closeAllPanels(){aboutSide.style.display="none";aboutOverlay.style.display="none";cartSide.style.display="none";cartOverlay.style.display="none";historySide.style.display="none";historyOverlay.style.display="none";}
openAboutBtn.addEventListener("click",()=>{closeAllPanels();aboutSide.style.display="block";aboutOverlay.style.display="block";});
closeAboutBtn.addEventListener("click",()=>{closeAllPanels();});
aboutOverlay.addEventListener("click",closeAllPanels);
openCartBtn.addEventListener("click",()=>{closeAllPanels();cartSide.style.display="block";cartOverlay.style.display="block";});
cartOverlay.addEventListener("click",closeAllPanels);
openHistoryBtn.addEventListener("click",()=>{closeAllPanels();historySide.style.display="block";historyOverlay.style.display="block";renderHistorySide();});
closeHistoryBtn.addEventListener("click",closeAllPanels);
historyOverlay.addEventListener("click",closeAllPanels);

// ===== 歷史訂單 =====
function renderHistorySide(){const ul=document.getElementById("historyListSide");ul.innerHTML="";if(currentMember && currentMember.orders.length>0){currentMember.orders.forEach(o=>{const li=document.createElement("li");const totalQty=o.items.reduce((a,b)=>a+b.qty,0);const totalPrice=o.items.reduce((a,b)=>a+b.qty*b.price,0);li.innerHTML=`訂單 #${o.id} | ${o.payment} | ${totalQty} 件 | $${totalPrice} <button class="viewDetail">查看明細</button>`;li.querySelector(".viewDetail").addEventListener("click",()=>{showOrderModal(o);});ul.appendChild(li);});} else ul.innerHTML="<li>尚無歷史訂單</li>";}
function showOrderModal(order){const modal=document.getElementById("orderModal");modal.innerHTML="";order.items.forEach(it=>{const div=document.createElement("div");div.textContent=`${it.name} x ${it.qty} - $${it.price*it.qty}`;modal.appendChild(div);});modal.innerHTML+=`<button onclick="closeOrderModal()">關閉</button>`;modal.style.display="block";document.getElementById("modalOverlay").style.display="block";}
function closeOrderModal(){document.getElementById("orderModal").style.display="none";document.getElementById("modalOverlay").style.display="none";}

// ===== 後台管理隱藏 =====
const adminForm=document.getElementById("adminForm");
const openAdminBtn=document.getElementById("openAdminBtn");
if(window.location.search.includes("admin=true")){adminForm.style.display="block";}
else{adminForm.style.display="none";}
openAdminBtn.addEventListener("click",()=>{if(adminForm.style.display==="block"){alert("後台已顯示");}else{alert("後台不可見，請加 ?admin=true 到 URL");}});

</script>
</body>
</html>
