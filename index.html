<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>貓貓燈具 - 精選燈飾</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  * {margin:0; padding:0; box-sizing:border-box;}
  body {font-family:Arial,sans-serif; background:#f4f4f4; color:#333; padding-top:env(safe-area-inset-top,0px); padding-bottom:70px;}
  header {background:#fff; padding:15px; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100; display:flex; justify-content:space-between; align-items:center;}
  header h1 {font-size:1.5em; color:#222; margin-left:15px;}
  .nav-links {display:flex; gap:15px; margin-right:15px; font-size:0.9em;}
  .nav-links a {color:#333; text-decoration:none;}
  .nav-links a:hover {color:#e74c3c;}
  .cart-icon {position:relative; margin-right:20px; cursor:pointer; font-size:1.4em; color:#333;}
  .cart-count {position:absolute; top:-8px; right:-8px; background:#e74c3c; color:#fff; font-size:0.7em; width:18px; height:18px; border-radius:50%; display:flex; align-items:center; justify-content:center;}
  .category-list {display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:20px 0; padding:0 15px;}
  .category-list button {padding:8px 16px; background:#eee; border:none; border-radius:20px; font-size:0.9em; cursor:pointer; transition:0.3s;}
  .category-list button.active, .category-list button:hover {background:#333; color:#fff;}
  .products {display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; padding:20px;}
  .product-card {
    background:#fff; border-radius:10px; padding:15px; text-align:center;
    box-shadow:0 1px 3px rgba(0,0,0,0.1); overflow:hidden; display:flex; flex-direction:column;
    cursor:pointer; transition:transform 0.2s;
  }
  .product-card:hover {transform:translateY(-3px);}
  .product-card img {
    width:100%; height:0; padding-bottom:100%; object-fit:cover; object-position:center;
    border-radius:8px; background:#f0f0f0; position:relative; display:block;
  }
  .product-card h3 {margin:12px 0 6px; font-size:1.1em; word-wrap:break-word; flex-grow:1;}
  .product-card p {margin:0 0 8px; color:#555; font-size:0.95em;}
  .product-card .price {font-weight:bold; color:#e74c3c; margin:8px 0;}
  .product-card button {
    padding:8px 16px; background:#333; border:none; border-radius:5px; color:#fff;
    cursor:pointer; font-size:0.9em; margin-top:auto;
  }
  .product-card button:hover {background:#555;}

  /* 購物車側邊欄 */
  .cart-sidebar {
    position:fixed; top:0; right:-400px; width:380px; height:100dvh; background:#fff;
    box-shadow:-2px 0 10px rgba(0,0,0,0.1); z-index:1000; transition:right 0.3s; overflow-y:auto;
    padding:20px; display:flex; flex-direction:column;
  }
  .cart-sidebar.open {right:0;}
  .cart-header {display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;}
  .cart-header h2 {font-size:1.3em;}
  .close-cart {cursor:pointer; font-size:1.5em; color:#999;}
  .cart-items {flex-grow:1; overflow-y:auto;}
  .cart-item {
    display:flex; align-items:center; padding:12px 0; border-bottom:1px solid #eee;
  }
  .cart-item img {width:60px; height:60px; object-fit:cover; border-radius:6px; margin-right:12px;}
  .cart-item-info {flex-grow:1;}
  .cart-item-info h4 {font-size:0.95em; margin:0 0 4px;}
  .cart-item-info p {margin:0; color:#e74c3c; font-weight:bold;}
  .qty-control {display:flex; align-items:center; gap:8px;}
  .qty-control button {width:24px; height:24px; background:#eee; border:none; border-radius:50%; cursor:pointer;}
  .cart-total {margin-top:20px; text-align:right; font-size:1.1em; font-weight:bold;}
  .checkout-btn {margin-top:15px; padding:12px; background:#333; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:1em;}
  .checkout-btn:hover {background:#555;}

  /* 會員系統 */
  .member-section {margin-top:20px; padding-top:20px; border-top:1px solid #eee;}
  .member-section h3 {margin-bottom:15px; font-size:1.1em;}
  .form-group {margin-bottom:15px;}
  .form-group label {display:block; margin-bottom:5px; font-size:0.9em;}
  .form-group input {width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; font-size:0.95em;}
  .member-btn {width:100%; margin-top:10px; padding:10px; background:#e74c3c; color:#fff; border:none; border-radius:6px; cursor:pointer;}
  .member-btn:hover {background:#c0392b;}
  .logout-btn {background:#999; margin-top:5px;}
  .logout-btn:hover {background:#777;}

  /* 歷史訂單 */
  .order-history {margin-top:20px; display:none;}
  .order-history h3 {margin-bottom:10px;}
  .order-item {background:#f9f9f9; padding:12px; border-radius:6px; margin-bottom:10px; font-size:0.9em;}

  /* 客服按鈕 */
  .cs-button {
    position:fixed; bottom:20px; right:20px; width:56px; height:56px; background:#333; color:#fff;
    border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.5em;
    box-shadow:0 4px 10px rgba(0,0,0,0.2); cursor:pointer; z-index:999;
  }
  .cs-button:hover {background:#555; transform:scale(1.1);}

  /* 手機版 */
  @media (max-width:768px) {
    .products {grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:15px; padding:15px;}
    .product-card {padding:10px;}
    .product-card h3 {font-size:1em;}
    .product-card button {padding:6px 12px; font-size:0.85em;}
    header h1 {font-size:1.3em;}
    .nav-links {font-size:0.8em; gap:8px;}
    .cart-sidebar {width:100%; right:-100%;}
  }
</style>
</head>
<body>

<header>
  <h1>貓貓燈具</h1>
  <div class="nav-links">
    <a href="#about">公司簡介</a>
    <a href="#contact">聯絡我們</a>
  </div>
  <div class="cart-icon" id="cartIcon">
    <i class="fas fa-shopping-cart"></i>
    <span class="cart-count" id="cartCount">0</span>
  </div>
</header>

<div class="category-list" id="categoryList"></div>
<div class="products" id="productList"><p>載入中...</p></div>

<!-- 公司簡介 -->
<div id="about" style="padding:30px 20px; background:#fff; margin:20px; border-radius:10px; display:none;">
  <h2>公司簡介</h2>
  <p>貓貓燈具成立於2020年，專注北歐風與極簡設計燈飾，提供高品質、平價的居家照明方案。</p>
</div>

<!-- 客服浮動按鈕 -->
<div class="cs-button" onclick="alert('客服電話：02-1234-5678\nLine ID：@catlamp')">
  <i class="fas fa-headset"></i>
</div>

<!-- 購物車側邊欄 -->
<div class="cart-sidebar" id="cartSidebar">
  <div class="cart-header">
    <h2>購物車</h2>
    <i class="fas fa-times close-cart" id="closeCart"></i>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-total">總計: <span id="cartTotal">$0</span></div>
  <button class="checkout-btn" id="checkoutBtn">結帳</button>

  <!-- 會員系統 -->
  <div class="member-section" id="memberSection">
    <h3 id="memberTitle">會員登入</h3>
    <div class="form-group">
      <label>帳號</label>
      <input type="text" id="account" placeholder="請輸入帳號">
    </div>
    <div class="form-group">
      <label>密碼</label>
      <input type="password" id="password" placeholder="請輸入密碼">
    </div>
    <button class="member-btn" id="memberBtn">登入</button>
  </div>

  <!-- 歷史訂單 -->
  <div class="order-history" id="orderHistory">
    <h3>歷史訂單</h3>
    <div id="orderList">尚未登入</div>
  </div>
</div>

<script>
let products = [];
let cart = JSON.parse(localStorage.getItem('catlamp_cart') || '[]');
let currentUser = null;

// 更新購物車圖示
function updateCartButton() {
  const count = cart.reduce((sum, item) => sum + item.qty, 0);
  document.getElementById('cartCount').textContent = count;
  document.getElementById('cartCount').style.display = count > 0 ? 'flex' : 'none';
}

// 渲染分類
function renderCategories() {
  const categories = new Set(["全部商品"]);
  products.forEach(p => categories.add(p.category));
  const list = document.getElementById("categoryList");
  list.innerHTML = "";
  Array.from(categories).sort().forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => {
      displayProducts(cat);
      list.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    };
    if (cat === "全部商品") btn.classList.add("active");
    list.appendChild(btn);
  });
}

// 顯示商品
function displayProducts(filter = "全部商品") {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  const filtered = filter === "全部商品" ? products : products.filter(p => p.category === filter);
  filtered.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
      <img src='${p.imgs[0]}' alt='${p.name}'>
      <h3>${p.name}</h3>
      <p>${p.desc}</p>
      <p class="price">$${p.price}</p>
      <button class="add-btn" data-id="${p.id}">加入購物車</button>
    `;
    card.onclick = (e) => {
      if (e.target.classList.contains('add-btn')) return;
      window.location.href = `product-detail.html?id=${p.id}`;
    };
    card.querySelector('.add-btn').onclick = (e) => {
      e.stopPropagation();
      addToCart(p.id);
    };
    list.appendChild(card);
  });
}

// 加入購物車
function addToCart(id) {
  const p = products.find(x => x.id === id);
  if (!p) return;
  const exist = cart.find(x => x.id === id);
  if (exist) exist.qty++;
  else cart.push({...p, qty:1});
  localStorage.setItem('catlamp_cart', JSON.stringify(cart));
  updateCartButton();
  renderCart();
  alert('已加入購物車！');
}

// 渲染購物車
function renderCart() {
  const items = document.getElementById('cartItems');
  const total = document.getElementById('cartTotal');
  if (cart.length === 0) {
    items.innerHTML = '<p style="text-align:center;color:#999;">購物車是空的</p>';
    total.textContent = '$0';
    return;
  }
  items.innerHTML = '';
  let sum = 0;
  cart.forEach(item => {
    sum += item.price * item.qty;
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src='${item.imgs[0]}' alt='${item.name}'>
      <div class="cart-item-info">
        <h4>${item.name}</h4>
        <p>$${item.price} × ${item.qty}</p>
      </div>
      <div class="qty-control">
        <button onclick='changeQty(${item.id}, -1)'>−</button>
        <span>${item.qty}</span>
        <button onclick='changeQty(${item.id}, 1)'>+</button>
      </div>
    `;
    items.appendChild(div);
  });
  total.textContent = `$${sum}`;
}

// 調整數量
window.changeQty = function(id, delta) {
  const item = cart.find(x => x.id === id);
  if (!item) return;
  item.qty += delta;
  if (item.qty <= 0) cart = cart.filter(x => x.id !== id);
  localStorage.setItem('catlamp_cart', JSON.stringify(cart));
  updateCartButton();
  renderCart();
};

// 會員系統
document.getElementById('memberBtn').onclick = () => {
  const account = document.getElementById('account').value.trim();
  const password = document.getElementById('password').value;
  if (!account || !password) return alert('請填寫完整！');

  if (account === 'admin' && password === '1234') {
    currentUser = {account};
    document.getElementById('memberTitle').textContent = `歡迎，${account}`;
    document.getElementById('memberBtn').textContent = '登出';
    document.getElementById('memberBtn').className = 'member-btn logout-btn';
    document.getElementById('orderHistory').style.display = 'block';
    renderOrders();
  } else {
    alert('帳號或密碼錯誤！');
  }
};

// 登出
document.getElementById('memberBtn').addEventListener('click', function() {
  if (this.textContent === '登出') {
    currentUser = null;
    this.textContent = '登入';
    this.className = 'member-btn';
    document.getElementById('memberTitle').textContent = '會員登入';
    document.getElementById('account').value = '';
    document.getElementById('password').value = '';
    document.getElementById('orderHistory').style.display = 'none';
  }
});

// 歷史訂單
function renderOrders() {
  const list = document.getElementById('orderList');
  const orders = JSON.parse(localStorage.getItem('catlamp_orders') || '[]');
  if (orders.length === 0) {
    list.innerHTML = '<p style="color:#999;">無訂單紀錄</p>';
    return;
  }
  list.innerHTML = '';
  orders.forEach(o => {
    const div = document.createElement('div');
    div.className = 'order-item';
    div.innerHTML = `<strong>訂單 ${o.id}</strong><br>時間: ${o.time}<br>總額: $${o.total}`;
    list.appendChild(div);
  });
}

// 結帳
document.getElementById('checkoutBtn').onclick = () => {
  if (cart.length === 0) return alert('購物車是空的！');
  if (!currentUser) return alert('請先登入會員！');

  const total = cart.reduce((s, i) => s + i.price * i.qty, 0);
  const order = {
    id: Date.now().toString().slice(-6),
    time: new Date().toLocaleString('zh-TW'),
    total,
    items: [...cart]
  };
  const orders = JSON.parse(localStorage.getItem('catlamp_orders') || '[]');
  orders.push(order);
  localStorage.setItem('catlamp_orders', JSON.stringify(orders));

  alert(`訂單已送出！\n訂單編號: ${order.id}\n總金額: $${total}`);
  cart = [];
  localStorage.setItem('catlamp_cart', '[]');
  updateCartButton();
  renderCart();
};

// 開關購物車
document.getElementById('cartIcon').onclick = () => {
  document.getElementById('cartSidebar').classList.add('open');
  renderCart();
};
document.getElementById('closeCart').onclick = () => {
  document.getElementById('cartSidebar').classList.remove('open');
};

// 顯示公司簡介
document.querySelector('a[href="#about"]').onclick = (e) => {
  e.preventDefault();
  document.getElementById('about').style.display = 'block';
  setTimeout(() => window.scrollTo(0, document.getElementById('about').offsetTop - 100), 100);
};

// 載入產品
fetch('products.json')
  .then(res => res.ok ? res.json() : Promise.reject())
  .then(data => {
    products = data;
    renderCategories();
    displayProducts();
    updateCartButton();
  })
  .catch(() => {
    document.getElementById('productList').innerHTML = '<p style="color:red;text-align:center;">載入失敗</p>';
  });
</script>

</body>
</html>
