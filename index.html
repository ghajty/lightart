<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>貓貓燈具 - 精選燈飾</title>
<style>
  * {margin:0; padding:0; box-sizing:border-box;}
  body {font-family:Arial,sans-serif; background:#f4f4f4; color:#333; padding-top:env(safe-area-inset-top,0px);}
  header {background:#fff; padding:15px; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100;}
  header h1 {font-size:1.5em; color:#222;}
  .category-list {display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:20px 0; padding:0 15px;}
  .category-list button {padding:8px 16px; background:#eee; border:none; border-radius:20px; font-size:0.9em; cursor:pointer; transition:0.3s;}
  .category-list button.active, .category-list button:hover {background:#333; color:#fff;}
  .products {display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; padding:20px;}
  .product-card {
    background:#fff; border-radius:10px; padding:15px; text-align:center;
    box-shadow:0 1px 3px rgba(0,0,0,0.1); overflow:hidden; display:flex; flex-direction:column;
    cursor:pointer; transition:transform 0.2s;
  }
  .product-card:hover {transform:translateY(-3px);}
  .product-card img {
    width:100%; height:0; padding-bottom:100%; object-fit:cover; object-position:center;
    border-radius:8px; background:#f0f0f0; position:relative; display:block;
  }
  .product-card h3 {margin:12px 0 6px; font-size:1.1em; word-wrap:break-word; flex-grow:1;}
  .product-card p {margin:0 0 8px; color:#555; font-size:0.95em;}
  .product-card .price {font-weight:bold; color:#e74c3c; margin:8px 0;}
  .product-card button {
    padding:8px 16px; background:#333; border:none; border-radius:5px; color:#fff;
    cursor:pointer; font-size:0.9em; margin-top:auto;
  }
  .product-card button:hover {background:#555;}

  /* 手機版優化 */
  @media (max-width:768px) {
    .products {
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
      gap:15px; padding:15px;
    }
    .product-card {padding:10px;}
    .product-card h3 {font-size:1em;}
    .product-card button {padding:6px 12px; font-size:0.85em;}
    header h1 {font-size:1.3em;}
    .category-list button {padding:6px 12px; font-size:0.8em;}
  }
</style>
</head>
<body>

<header>
  <h1>貓貓燈具</h1>
</header>

<div class="category-list" id="categoryList"></div>

<div class="products" id="productList">
  <p>載入中...</p>
</div>

<script>
// 全域變數
let cart = JSON.parse(localStorage.getItem('catlamp_cart') || '[]');

// 載入 products.json
fetch('products.json')
  .then(res => res.ok ? res.json() : Promise.reject('找不到 products.json'))
  .then(data => {
    window.products = data;
    renderCategories();
    displayProducts();
  })
  .catch(err => {
    console.error(err);
    document.getElementById('productList').innerHTML = '<p style="color:red;text-align:center;">載入產品失敗</p>';
  });

// 分類按鈕
function renderCategories() {
  const categories = new Set(["全部商品"]);
  products.forEach(p => categories.add(p.category));
  const list = document.getElementById("categoryList");
  list.innerHTML = "";
  Array.from(categories).sort().forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => {
      displayProducts(cat);
      list.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    };
    if (cat === "全部商品") btn.classList.add("active");
    list.appendChild(btn);
  });
}

// 顯示商品
function displayProducts(filter = "全部商品") {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  const filtered = filter === "全部商品" ? products : products.filter(p => p.category === filter);
  filtered.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
      <img src='${p.imgs[0]}' alt='${p.name}'>
      <h3>${p.name}</h3>
      <p>${p.desc}</p>
      <p class="price">$${p.price}</p>
      <button class="add-btn" data-id="${p.id}">加入購物車</button>
    `;
    card.onclick = (e) => {
      if (e.target.classList.contains('add-btn')) return;
      window.location.href = `product-detail.html?id=${p.id}`;
    };
    card.querySelector('.add-btn').onclick = (e) => {
      e.stopPropagation();
      addToCart(p.id);
    };
    list.appendChild(card);
  });
}

// 加入購物車
function addToCart(id) {
  const p = products.find(x => x.id === id);
  if (!p) return;
  const exist = cart.find(x => x.id === id);
  if (exist) exist.qty++;
  else cart.push({...p, qty:1});
  localStorage.setItem('catlamp_cart', JSON.stringify(cart));
  alert('已加入購物車！');
}

// 頁面載入完成
window.displayProducts = displayProducts;
window.renderCategories = renderCategories;
window.addToCart = addToCart;
</script>

</body>
</html>
